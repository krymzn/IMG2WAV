<!DOCTYPE html>
<html>
  <head>
    <title>img2wav</title>
  </head>
  <body>
    <h1></h1>
    <div
      style="
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      "
    >
      <img
        style="padding-top: 1rem; padding-bottom: 1rem"
        id="output_image"
        height="250px"
        width="250px"
      />
      <form>
        <input type="file" onchange="preview_image(event)" />
        <button type="submit" onclick="submit_form(event)">Submit Image</button>
      </form>

      <script type="text/javascript">
        console.log(`SCRIPT CALLLED`);
        let readerResult;
        function preview_image(event) {
          var reader = new FileReader();
          reader.onload = function () {
            var output = document.getElementById("output_image");
            output.src = reader.result;
            readerResult = reader.result;
          };
          reader.readAsDataURL(event.target.files[0]);
        }

        function submit_form(event) {
          console.log(`SUBMIT FORM CALLLED`);
          event.preventDefault();
          fetch("http://localhost:5001/upload-image", {
            method: "POST",
            mode: "cors",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ file: readerResult }),
          })
            .then((res) => {
              console.log("FETCH RESPONSE", res);
              localStorage.setItem("FETCH RES", res);
            })
            .catch((err) => {
              console.log("FETCH ERROR", err);
              localStorage.setItem("FETCH ERR", err);
            });
          // window.location.href = "play.html";
        }
      </script>
    </div>
  </body>
</html>
